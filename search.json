[{"title":"Telegram Bot开发01：创建自己的Bot","url":"/2024/09/06/Telegram-Bot开发01：创建自己的Bot/","content":"\n# 0x00: 介绍\n\nTelegram Bot 是在 Telegram上运行的自动化账户，用户可以和它聊天，或者在群组和频道中使用它们。通过对Telegram Bot进行开发，可以实现如聊天机器人、自动化工具、游戏等等功能。\n\nBotFather是一个专门用来管理其他Bot的Telegram账户。通过BotFather，可以创建一个新的Bot，并且对Bot设置名称、描述、命令列表等等。\n\n本篇文章将会介绍如何创建一个Bot，并对Bot进行基本设置。与此同时，还会讲解相关的概念。\n\n\n\n# 0x01：创建Bot\n\n打开[@BotFather](https://t.me/botfather)：\n\n![image-20240820094023202](/images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240820094023202.png)\n\n\n\n创建机器人：发送`/newbot`指令创建机器人，随后设置Bot的名称和用户名。\n\n![image-20240820094343570](/images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240820094343570.png)\n\n在成功创建Bot后，会给你一个API Token，这是与你机器人进行HTTP请求交互的关键。请务必保存好，不要泄漏。\n\n通过浏览器访问：`https://api.telegram.org/bot<API Token>/getMe` (API Token替换成你的)\n\n会返回JSON格式的Bot相关信息：\n\n```json\n{\n  \"ok\": true,\n  \"result\": {\n    \"id\": 7190564445,\n    \"is_bot\": true,\n    \"first_name\": \"BotDemo\",\n    \"username\": \"demo18293_bot\",\n    \"can_join_groups\": true,\n    \"can_read_all_group_messages\": false,\n    \"supports_inline_queries\": true,\n    \"can_connect_to_business\": false,\n    \"has_main_web_app\": false\n  }\n}\n```\n\n\n\n# 0x02：相关概念\n\n这里先介绍一下Bot相关的概念，方便后面的编辑操作。\n\n### 1. 命令列表\n\n当你在Bot的对话框中输入`/`（点击菜单同理），就会列出所有命令：\n\n![image-20240821144721503](../images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240821144721503.png)\n\n前方的粗体是具体命令，后方的灰字是对命令的说明。\n\n\n\n### 2. 内联模式\n\n内联模式（inline mode）允许用户在任何聊天窗口（包括与其他用户的对话或群组中）通过输入Bot的**用户名**来触发内联查询：\n\n![image-20240821145635903](./images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240821145635903.png)\n\nBot会返回结果供用户选择，并发送到当前聊天中。\n\n\n\n### 3. 回复键盘\n\n回复键盘（Reply Keyboard）是一种出现在输入框下方的按钮集合。点击按钮，会发送预设好的消息：\n\n![image-20240821150329284](./images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240821150329284.png)\n\n你点击【❓ 帮助】按钮，和直接发送”❓ 帮助“消息是一样的。\n\n\n\n### 4. 内联键盘\n\n内联键盘（Inline Keyboard）是一种在消息内容下方显示的按钮。与”回复键盘“不同，点击按钮时，并不会发送消息，而是进行相关操作，比如说：执行特定的命令、打开网址、发起支付等等。\n\n![image-20240821151648011](./images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240821151648011.png)\n\n\n\n# 0x03：编辑Bot\n\n编辑Bot有两种方式，一种是直接发送`/setxxx`命令，另外一种比较方便，通过内联键盘进行设置。虽然方式不同，但本质是一样的，每个键盘选项大都对应着相关的命令。这里就以后者进行演示：\n\n发送`/mybots`命令，然后选择Bot：\n\n![image-20240821135829637](./images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240821135829637.png)\n\n点击【Edit Bot】：\n\n![image-20240821140029492](./images/Telegram-Bot%E5%BC%80%E5%8F%9101%EF%BC%9A%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Bot/image-20240821140029492.png)\n\n上面的消息是Bot当前的设置，下面是可进行的操作。每个选项大都有着对应的命令：\n\n- 【Edit Name】<==> `/setname `：设置Bot的名称；\n- 【Edit About】<==> `/setabouttext`：设置Bot的关于信息，在Bot的个人资料页面上可以看到；\n- 【Edit Description】<==> `/setdescription`：设置Bot的描述，将在与Bot对话的开头看到；\n- 【Edit Description Picture】：(没有命令) 设置描述上方的图片，可以是GIF，不过对尺寸有要求；\n- 【Edit Botpic】<==> `/setuserpic`：设置Bot的头像；\n- 【Edit Commands】<==> `/setcommands`：设置Bot支持的命令列表；（命令 + 说明）\n- 【Edit inline placeholder】<==> `/setinline`：设置Bot内联查询的提示词；\n- 【Edit Privacy Policy】：设置隐私条款，未设置时默认为使用官方的隐私条款；\n\n以上就是Bot的基本设置！\n\n\n\n另外，列一些个人觉得比较重要的命令：\n\n```\n/token:  获取HTTP API token\n/revoke: 吊销HTTP API token\n/cancel: 取消当前正在进行的操作\n/deletebot: 删除机器人\n```\n\n\n\n# 0x04：最后\n\n本篇文章的操作捏出了Bot的**形**，但是还不能进行真正的处理。虽然定义了命令列表，但此时发送命令，Bot是没有任何反应的。后面我们还需要给Bot编写程序，注入灵魂，让它动起来。\n\n\n\n","tags":["TON"],"categories":["blockchain"]},{"title":"广州到深圳之莽夫骑行","url":"/2024/08/06/hello-world/","content":"\n\n# 待更新...\n","tags":["骑行"],"categories":["life"]},{"title":"Android逆向：修改APK并重打包签名","url":"/2024/08/06/修改APK并重打包签名/","content":"\n在Android逆向中，经常需要对APK修改，然后重新打包并签名。这篇文章中，介绍了如何使用各个工具来完成这个过程。\n\n各个步骤以及所需工具：\n\n1. 解压APK文件； 工具：apktool\n2. 进行修改； 工具：看修改需求\n3. 重新打包APK； 工具：apktool\n4. 将APK对齐； 工具：zipalign\n5. 生成密钥文件，并对APK进行签名；工具：keytool、jarsigner\n\n\n\n小白鼠：demo.apk\n\n#### 目标：\n\n将`addThreeNum(1, 2, 3)`改为`addThreeNum(4, 5, 6)`，并且修改后能够成功运行。\n\n![image-20240806103111215](\\images\\修改APK并重打包签名\\image-20240806103111215.png)\n\n\n\n> demo.apk下载：https://www.123pan.com/s/9j4Xjv-MMAhv.html?提取码:tgno\n>\n> 用到的工具可自行从网上获取。\n\n\n\n#### 步骤1：解压APK\n\n使用apktool解压APK到output目录下\n\n```powershell\nE:\\> apktool d .\\demo.apk -o output\\\nI: Using Apktool 2.7.0 on demo.apk\nI: Loading resource table...\nI: Decoding AndroidManifest.xml with resources...\nI: Loading resource table from file: C:\\Users\\aaaka\\AppData\\Local\\apktool\\framework\\1.apk\nI: Regular manifest package...\nI: Decoding file-resources...\nI: Decoding values */* XMLs...\nI: Baksmaling classes.dex...\nI: Copying assets and libs...\nI: Copying unknown files...\nI: Copying original files...\nI: Copying META-INF/services directory\n```\n\n\n\n#### 步骤2：修改\n\n在output\\smali\\com\\example\\myapplication\\MainActivity.smail中，把`1 2 3 `改为` 4 5 6`\n\n![image-20240806095045017](\\images\\修改APK并重打包签名\\image-20240806095045017.png)\n\n\n\n#### 步骤3：重打包\n\n解压的逆过程，将output目录打包为newdemo.apk\n\n```powershell\nE:\\> apktool b output\\ -o .\\newdemo.apk\nI: Using Apktool 2.7.0\nI: Checking whether sources has changed...\nI: Smaling smali folder into classes.dex...\nI: Checking whether resources has changed...\nI: Building resources...\nI: Copying libs... (/lib)\nI: Copying libs... (/kotlin)\nI: Copying libs... (/META-INF/services)\nI: Building apk file...\nI: Copying unknown files/dir...\nI: Built apk into: .\\newdemo.apk\n```\n\n\n\n#### 步骤4：APK对齐\n\n（注意：当用到NDK开发，含有.so库时，需要添加`-p`参数）\n\n```powershell\nE:\\> zipalign -p -v 4 .\\newdemo.apk .\\newdemo-aligned.apk\nVerifying alignment of .\\newdemo-aligned.apk (4)...\n      49 AndroidManifest.xml (OK - compressed)\n    1688 classes.dex (OK - compressed)\n 3296246 kotlin/annotation/annotation.kotlin_builtins (OK - compressed)\n 3296897 kotlin/collections/collections.kotlin_builtins (OK - compressed)\n 3298508 kotlin/coroutines/coroutines.kotlin_builtins (OK - compressed)\n \t\t\t\t......(省略)......\n 3731560 resources.arsc (OK)\n 4709532 assets/dexopt/baseline.prof (OK)\n 4711368 assets/dexopt/baseline.profm (OK)\n 4711611 DebugProbesKt.bin (OK - compressed)\nVerification succesful\n```\n\n\n\n#### 步骤5：生成`.jks`密钥文件\n\n各个参数的含义可自行了解\n\n```powershell\nE:\\> keytool -genkeypair -v -keystore key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias akakey\n输入密钥库口令:\n再次输入新口令:\n您的名字与姓氏是什么?\n  [Unknown]:  aka\n您的组织单位名称是什么?\n  [Unknown]:  Reverse\n您的组织名称是什么?\n  [Unknown]:  Android\n您所在的城市或区域名称是什么?\n  [Unknown]:  shenzhen\n您所在的省/市/自治区名称是什么?\n  [Unknown]:  guangdong\n该单位的双字母国家/地区代码是什么?\n  [Unknown]:  CN\nCN=aka, OU=Reverse, O=Android, L=shenzhen, ST=guangdong, C=CN是否正确?\n  [否]:  是\n\n正在为以下对象生成 2,048 位RSA密钥对和自签名证书 (SHA256withRSA) (有效期为 10,000 天):\n         CN=aka, OU=Reverse, O=Android, L=shenzhen, ST=guangdong, C=CN\n[正在存储key.jks]\n```\n\n\n\n#### 步骤6：重签名\n\n```powershell\nE:\\> apksigner sign --ks key.jks --ks-key-alias akakey --out .\\newdemo-aligned-signed.apk .\\newdemo-aligned.apk\nKeystore password for signer #1:\nE:\\>\n```\n\n\n\n#### 最后：尝试运行\n\n可以成功运行，并且修改有效。\n\n![image-20240806102009372](\\images\\修改APK并重打包签名\\image-20240806102009372.png)\n\n\n\n#### 思考：\n\n既然APK可以二次签名，并且能够成功运行。那么，APK中签名机制所起到的作用是什么呢？就是资源文件中META-INF目录下的`.RSA .SF .MF`三个文件。\n\n![image-20240806120006871](\\images\\修改APK并重打包签名\\image-20240806120006871.png)","tags":["Android","逆向"],"categories":["security"]}]
<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <title>
      
        Aptos & Move | 类型系统 | 卡  卡
      
    </title>
    <meta name="description" content="  " />
    <meta name="keywords" content="" />
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/panda.avif" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/panda.avif" />
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/panda.avif" />
    
    
      <link rel="mask-icon"
            href="/images/panda.avif"
            color="" />
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/normal.ttf);
        font-weight: normal;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css' />
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css"/>
  

  <meta name="generator" content="Hexo 7.3.0"></head>
  <body>
    
      <div id="search-mask" style="display:none">
  <div class="search-main" id="search-main">
    <div class="search__head">
      <div class="search-form">
        <svg t="1706347533072"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="7828"
             width="20"
             height="20">
          <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
          </path>
        </svg>
        <input id="search-input" placeholder="搜索文章">
        <svg t="1706361500528"
             id="search-clear"
             class="icon"
             viewBox="0 0 1024 1024"
             version="1.1"
             xmlns="http://www.w3.org/2000/svg"
             p-id="4351"
             width="20"
             height="20">
          <path d="M512 562.688l-264.2944 264.2944-50.688-50.688L461.312 512 197.0176 247.7056l50.688-50.688L512 461.312l264.2944-264.2944 50.688 50.688L562.688 512l264.2944 264.2944-50.688 50.688L512 562.688z" fill="#00" p-id="4352">
          </path>
        </svg>
      </div>
    </div>
    <div class="search__body" id="search-result"></div>
    <div class="search__foot"></div>
  </div>
</div>

    
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/panda.avif" />
        </a>
        <input id="navBtn" type="checkbox" />
        <div class="nav-right">
          
            <div class="search-outer">
  <div class="search" id="search-btn">
    <svg t="1706347533072"
         class="icon"
         viewBox="0 0 1024 1024"
         version="1.1"
         xmlns="http://www.w3.org/2000/svg"
         p-id="7828"
         width="20"
         height="20">
      <path d="M685.6 660.336l155.152 155.168a16 16 0 0 1 0 22.624l-11.312 11.328a16 16 0 0 1-22.624 0l-158.528-158.544a289.792 289.792 0 0 1-165.152 51.36C322.336 742.256 192 611.904 192 451.12 192 290.336 322.336 160 483.136 160c160.784 0 291.12 130.336 291.12 291.136 0 82.112-33.984 156.272-88.672 209.2z m-202.464 33.92c134.272 0 243.12-108.848 243.12-243.12C726.256 316.848 617.408 208 483.136 208 348.848 208 240 316.848 240 451.136c0 134.272 108.848 243.12 243.136 243.12z" fill="#000000" p-id="7829">
      </path>
    </svg>
    <span>搜索</span>
    <span class="search-shortcut-key">Ctrl K</span>
  </div>
</div>

          
          <div class="nav-menu">
            
              
                <a class="nav-menu-item" href="/blockchain">区 块 链</a>
              
                <a class="nav-menu-item" href="/security">计算机安全</a>
              
                <a class="nav-menu-item" href="/life">生 活</a>
              
            
            
          </div>
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">Aptos & Move | 类型系统</div>
        <div class="post-info">
          
  <a href="/tags/Aptos/" class="post-tag">#Aptos</a><a href="/tags/Move/" class="post-tag">#Move</a>


          <span class="post-date">2024-10-05</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="post-toc-text">0x00: 前言</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x01%EF%BC%9Ainteger"><span class="post-toc-text">0x01：integer</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x02-bool"><span class="post-toc-text">0x02: bool</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x03-address"><span class="post-toc-text">0x03: address</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x04-signer"><span class="post-toc-text">0x04: signer</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x05-Vector"><span class="post-toc-text">0x05: Vector</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-vector"><span class="post-toc-text">1. vector</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-big-vector"><span class="post-toc-text">2. big vector</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-smart-vector"><span class="post-toc-text">3. smart vector</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x06-Table"><span class="post-toc-text">0x06: Table</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-table"><span class="post-toc-text">1. table</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-smart-table"><span class="post-toc-text">2. smart table</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x07%EF%BC%9ASimple-Map"><span class="post-toc-text">0x07：Simple Map</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#0x08-other"><span class="post-toc-text">0x08: other</span></a></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00: 前言"></a>0x00: 前言</h2><p>Aptos move中的基础类型和其它语言大同小异，在学习aptos合约开发时，重点可以放在去清楚vector、table、sample map的可以进行的操作。本篇文章为参加Aptos共学的笔记，更加系统更加详细的内容可查看官方文档：<a target="_blank" rel="noopener" href="https://aptos.dev/en/build/smart-contracts/book">https://aptos.dev/en/build/smart-contracts/book</a></p>
<br>

<h2 id="0x01：integer"><a href="#0x01：integer" class="headerlink" title="0x01：integer"></a>0x01：integer</h2><p>Move仅支持6种无符号整数类型：<code>u8</code>、<code>u16</code>、<code>u32</code>、<code>u64</code>、<code>u128</code>、<code>u256</code>。</p>
<p>在Move中，<strong>数字常量值</strong>可以添加<strong>类型后缀</strong>，如<code>22893u32</code>。此时，如果该值被用于赋值某变量，且该变量未指定类型，则编译会先尝试从常量值的上下文推断类型（根据变量名和常数值进行推断），再根据值的大小进行推断。</p>
<p>除了<strong>类型后缀</strong>之外，数字常量值还可以用下划线<code>_</code>划分，如<code>1_234_5678</code>，<code>1_000u128</code>、<code>0xAB_CD_12_3</code>。使用该特点可以很方便地表示金额，如<code>10_000_000_000</code>。</p>
<p>整数可以使用<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>、<code>%</code>进行运算，但均存在异常中断的可能。如<code>+</code>和<code>*</code>结果过大时，<code>-</code>结果小于0时，<code>/</code>和<code>%</code>除数为0时。另外，还可以进行<code>&amp;</code>、<code>|</code>、<code>^</code>位运算，而位运算不会中止。</p>
<p>在对整数进行一些运算操作时，会对整数的类型有要求。值得庆幸的是，整数类型可以进行转换：<code>(e as T)</code>，将e转为T类型，如果T类型装不下e，则会发生异常。在Move v2中，可以不用括号，<code>e as T</code>即可。</p>
<br>

<h2 id="0x02-bool"><a href="#0x02-bool" class="headerlink" title="0x02: bool"></a>0x02: bool</h2><p><code>bool</code>，值为<code>true</code>或<code>false</code>。可进行的逻辑运算：<code>&amp;&amp;</code>、<code>||</code>、<code>!</code>。</p>
<br>

<h2 id="0x03-address"><a href="#0x03-address" class="headerlink" title="0x03: address"></a>0x03: address</h2><p><code>address</code>，是Move的内建类型。其256 bits。给定一个address，可以存储：<strong>Modules</strong>和<strong>Resources</strong></p>
<p>地址有两种类型: named 或 numerical。</p>
<br>

<h2 id="0x04-signer"><a href="#0x04-signer" class="headerlink" title="0x04: signer"></a>0x04: signer</h2><p><code>signer</code>是Move内置的资源类型。（？signer是一种允许<strong>持有者</strong>代表<strong>特定地址</strong>进行操作的能力）</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">module <span class="number">0x1</span>::signer &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">signer</span> has drop &#123; addr: address &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>signer</code>的值很特殊，不能通过数字值或指令来创建，只能由Move VM创建。</p>
<p>signer类型常见的一个操作函数是：<code>signer::address_of(&amp;signer)</code>，返回值为内部包裹的address。</p>
<br>

<h2 id="0x05-Vector"><a href="#0x05-Vector" class="headerlink" title="0x05: Vector"></a>0x05: Vector</h2><p>有三种vector可以使用：</p>
<ul>
<li><p><strong>vector</strong>：基本的vector，和大多OOP语言中的一样。其内部是存储成byte array；</p>
</li>
<li><p><strong>big vector</strong>：底层用table存储的vector，可以放大量数据；</p>
</li>
<li><p><strong>smart vector</strong>：底层也是用table存储，放小量数据时和vector类似，放大量数据时和big vector类似，比较灵活；</p>
</li>
</ul>
<br>

<h4 id="1-vector"><a href="#1-vector" class="headerlink" title="1. vector"></a>1. vector</h4><p><code>vector&lt;T&gt;</code>：存储多个<code>T</code>类型的数值，可以扩大或收缩。</p>
<blockquote>
<p>vector在Move中的一个常见用例是”byte arrays”，其本质为<code>vector&lt;u8&gt;</code>。比如，Byte String(<code>b&quot;Hello!\n&quot;</code>)和Hex String(<code>x&quot;48656C6C6F210A&quot;</code>)。</p>
</blockquote>
<p>常见操作：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// empty(),创建一个空的 vector。用于存储 u8 类型的数据</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v</span>: vector&lt;<span class="type">u8</span>&gt; = vector::empty&lt;<span class="type">u8</span>&gt;();</span><br><span class="line"><span class="comment">// 检查 vector 是否为空</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">is_empty</span>: <span class="type">bool</span> = vector::<span class="title function_ invoke__">is_empty</span>(&amp;v);</span><br><span class="line"></span><br><span class="line">vector::<span class="title function_ invoke__">push_back</span>(&amp;<span class="keyword">mut</span> v, <span class="number">10</span>);  <span class="comment">// 向 vector 中添加值 10</span></span><br><span class="line">vector::<span class="title function_ invoke__">push_back</span>(&amp;<span class="keyword">mut</span> v, <span class="number">20</span>);  <span class="comment">// 向 vector 中添加值 20</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">len</span>: <span class="type">u64</span> = vector::<span class="title function_ invoke__">length</span>(&amp;v);  <span class="comment">// 获取 vector 的长度</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">removed_value</span>: <span class="type">u8</span> = vector::<span class="title function_ invoke__">pop_back</span>(&amp;<span class="keyword">mut</span> v);  <span class="comment">// 删除并返回最后一个元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">val</span>: &amp;<span class="type">u8</span> = vector::<span class="title function_ invoke__">borrow</span>(&amp;v, <span class="number">0</span>);  <span class="comment">// 获取 vector 中第 0 个元素</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">val</span>: &amp;<span class="keyword">mut</span> <span class="type">u8</span> = vector::<span class="title function_ invoke__">borrow_mut</span>(&amp;<span class="keyword">mut</span> v, <span class="number">0</span>);  <span class="comment">// 获取第 0 个元素的可变引用</span></span><br><span class="line"></span><br><span class="line">vector::<span class="title function_ invoke__">swap</span>(&amp;<span class="keyword">mut</span> v, <span class="number">0</span>, <span class="number">50</span>);  <span class="comment">// 将 vector 中第 0 个元素替换为 50</span></span><br></pre></td></tr></table></figure>

<p>还可以进行的操作有：附加另一个vector，vector内元素的倒置，判断是否包含某个元素，删除空的vector等等….</p>
<br>

<h4 id="2-big-vector"><a href="#2-big-vector" class="headerlink" title="2. big vector"></a>2. big vector</h4><p>函数列表看起来怪怪的，还没使用过，后续看情况再补充这部分的内容吧。</p>
<p><img src="/images/Aptos%20&%20Move%20%20%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F/image-20241005100952956.png" alt="image-20241005100952956"></p>
<br>

<h4 id="3-smart-vector"><a href="#3-smart-vector" class="headerlink" title="3. smart vector"></a>3. smart vector</h4><p><code>smart vector</code>是基于<code>Table</code>的可扩展向量实现，其中元素被分组到存储桶(buckets)中。这种数据结构通过将小向量的灵活性与较大结构的可扩展性相结合，可以有效地处理大型数据集。</p>
<p>常见操作:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建空的smart vector</span></span><br><span class="line">new&lt;T: store&gt;(): SmartVector&lt;T&gt;</span><br><span class="line"><span class="comment">// 销毁空的vector</span></span><br><span class="line">destroy_empty&lt;T&gt;(v: SmartVector&lt;T&gt;)</span><br><span class="line"><span class="comment">// 销毁vector和内部的元素</span></span><br><span class="line">destroy&lt;T: drop&gt;(v: SmartVector&lt;T&gt;)</span><br><span class="line"><span class="comment">// 附加个元素</span></span><br><span class="line">push_back&lt;T: store&gt;(v: &amp;<span class="keyword">mut</span> SmartVector&lt;T&gt;, val: T)</span><br><span class="line"><span class="comment">// 弹出末尾元素</span></span><br><span class="line">pop_back&lt;T&gt;(v: &amp;<span class="keyword">mut</span> SmartVector&lt;T&gt;): T</span><br><span class="line"><span class="comment">// 移除某个元素</span></span><br><span class="line">remove&lt;T&gt;(v: &amp;<span class="keyword">mut</span> SmartVector&lt;T&gt;, i: <span class="type">u64</span>): T</span><br><span class="line"><span class="comment">// 获取元素</span></span><br><span class="line">borrow&lt;T&gt;(v: &amp;SmartVector&lt;T&gt;, i: <span class="type">u64</span>): &amp;T</span><br><span class="line"><span class="comment">// 获取可变的元素</span></span><br><span class="line">borrow_mut&lt;T&gt;(v: &amp;<span class="keyword">mut</span> SmartVector&lt;T&gt;, i: <span class="type">u64</span>): &amp;<span class="keyword">mut</span> T</span><br><span class="line"></span><br><span class="line">length&lt;T&gt;(v: &amp;SmartVector&lt;T&gt;): <span class="type">u64</span></span><br><span class="line">is_empty&lt;T&gt;(v: &amp;SmartVector&lt;T&gt;): <span class="type">bool</span></span><br><span class="line">clear&lt;T: drop&gt;(v: &amp;<span class="keyword">mut</span> SmartVector&lt;T&gt;)</span><br><span class="line"><span class="comment">// smart vector转为原生的vector</span></span><br><span class="line">to_vector&lt;T: store + copy&gt;(v: &amp;SmartVector&lt;T&gt;): vector&lt;T&gt;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="0x06-Table"><a href="#0x06-Table" class="headerlink" title="0x06: Table"></a>0x06: Table</h2><p>Table分为两种，一个是基础的table，一个是smart table。</p>
<br>

<h4 id="1-table"><a href="#1-table" class="headerlink" title="1. table"></a>1. table</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create Table</span></span><br><span class="line">new&lt;K: copy + drop, V: store&gt;(): Table&lt;K, V&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Aborts if the key already exists</span></span><br><span class="line">add&lt;K: copy + drop, V&gt;(table: &amp;<span class="keyword">mut</span> Table&lt;K, V&gt;, key: K, val: V)</span><br><span class="line"><span class="comment">// Aborts if the key is not found.</span></span><br><span class="line">remove&lt;K: copy + drop, V&gt;(table: &amp;<span class="keyword">mut</span> Table&lt;K, V&gt;, key: K): V</span><br><span class="line"><span class="comment">// Inserts or updates a key-value pair.</span></span><br><span class="line">upsert&lt;K: copy + drop, V: drop&gt;(table: &amp;<span class="keyword">mut</span> Table&lt;K, V&gt;, key: K, value: V)</span><br><span class="line"></span><br><span class="line">borrow&lt;K: copy + drop, V&gt;(table: &amp;Table&lt;K, V&gt;, key: K): &amp;V</span><br><span class="line">borrow_with_default&lt;K: copy + drop, V&gt;(table: &amp;Table&lt;K, V&gt;, key: K, default: &amp;V): &amp;V</span><br><span class="line">borrow_mut&lt;K: copy + drop, V&gt;(table: &amp;<span class="keyword">mut</span> Table&lt;K, V&gt;, key: K): &amp;<span class="keyword">mut</span> V</span><br><span class="line">borrow_mut_with_default&lt;K: copy + drop, V: drop&gt;(table: &amp;<span class="keyword">mut</span> Table&lt;K, V&gt;, key: K, default: V): &amp;<span class="keyword">mut</span> V</span><br><span class="line"></span><br><span class="line">contains&lt;K: copy + drop, V&gt;(table: &amp;Table&lt;K, V&gt;, key: K): <span class="type">bool</span></span><br></pre></td></tr></table></figure>

<br>

<h4 id="2-smart-table"><a href="#2-smart-table" class="headerlink" title="2. smart table"></a>2. smart table</h4><p>smart table是基于线性哈希（linear hash）的可扩展哈希表实现。旨在通过线性哈希来优化存储和性能。线性哈希一次分割一个存储桶，而不是将存储桶的数量加倍，从而避免意外的天然气成本。smart table使用 SipHash 函数来实现更快的哈希计算，同时容忍冲突。</p>
<p>关键数据结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct SmartTable&lt;K, V&gt; has store &#123;</span><br><span class="line">    buckets: table_with_length::TableWithLength&lt;u64, vector&lt;smart_table::Entry&lt;K, V&gt;&gt;&gt;,</span><br><span class="line">    num_buckets: u64,</span><br><span class="line">    level: u8,</span><br><span class="line">    size: u64,</span><br><span class="line">    split_load_threshold: u8,</span><br><span class="line">    target_bucket_size: u64</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public fun new&lt;K: copy, drop, store, V: store&gt;(): smart_table::SmartTable&lt;K, V&gt;</span><br><span class="line">public fun new_with_config()</span><br><span class="line">public fun destroy_empty()</span><br><span class="line">public fun destroy()</span><br><span class="line">public fun clear()  // 清空</span><br><span class="line">public fun add()   // 添加键值对</span><br><span class="line">public fun add_all()</span><br><span class="line">remove()  // 通过键进行移除</span><br><span class="line">upsert()  // 插入或更新键值对</span><br><span class="line"></span><br><span class="line">borrow()</span><br><span class="line">borrow_with_default()</span><br><span class="line">borrow_mut()</span><br><span class="line">borrow_mut_with_default()</span><br><span class="line"></span><br><span class="line">length()</span><br><span class="line">load_factor()  //返回load factor</span><br><span class="line">update_split_load_threshold()</span><br><span class="line">update_target_bucket_size()</span><br><span class="line">to_simple_map()</span><br></pre></td></tr></table></figure>

<br>

<h2 id="0x07：Simple-Map"><a href="#0x07：Simple-Map" class="headerlink" title="0x07：Simple Map"></a>0x07：Simple Map</h2><p><code>aptos_std::simple_map</code>：（本质上是对vector的封装）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 关键结构体</span><br><span class="line">struct SimpleMap&lt;Key, Value&gt; has copy, drop, store</span><br><span class="line"></span><br><span class="line">length()  // 获取长度</span><br><span class="line">new()  //创建空的SimpleMap</span><br><span class="line">new_from()  //使用vector类型的keys和values创建Simple</span><br><span class="line">borrow()</span><br><span class="line">borrow_mut()</span><br><span class="line">contains_key()  // 是否含有某个key</span><br><span class="line">destory_empty()</span><br><span class="line">add()     //添加key/value，key不能已经存在</span><br><span class="line">add_all()  // 联想new_from()</span><br><span class="line">upsert()   // 插入或更新</span><br><span class="line">keys()    // 返回vector&lt;key&gt;</span><br><span class="line">values()   // 返回vector&lt;value&gt;</span><br><span class="line">to_vec_pair() // 返回(vector&lt;Key&gt;, vector&lt;Value&gt;)</span><br><span class="line">destory()   // ???</span><br><span class="line">remove()   // key必须存在</span><br><span class="line">find()     </span><br></pre></td></tr></table></figure>

<br>

<h2 id="0x08-other"><a href="#0x08-other" class="headerlink" title="0x08: other"></a>0x08: other</h2><p>Move中局部变量通过<code>let</code>进行定义，局部变量有一定的作用域。</p>
<p>局部变量的名称可以包含<code>_</code>、<code>a-z</code> <code>A-Z</code>、<code>0-9</code>。但需要注意，开头必须为<code>_</code>或<code>a-z</code>开头，不允许以大写字母开头。</p>
<p>在定义局部变量时可以添加类型注释：<code>let x: T = e</code>，或者由编译器进行推断。泛型可能推断不出来。</p>
<p>一次定义多个局部变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let (x, y): (&amp;u64, &amp;mut u64) = (&amp;0, &amp;mut 1);</span><br></pre></td></tr></table></figure>


      </div>
    </div>
    
      <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script>
      <script>
        if (window.mermaid) {
          mermaid.initialize({"startOnload":true});
        }
      </script>
    
  </article>
  <div class="post__foot">
    
      <div class="like-author">
  <input type="checkbox" id="likeCode" />
  <div class="author-face">
    <img height="100px"
         width="100px"
         id="front-face"
         alt="author face"
         src="/images/about2.jpg" />
    <img height="100px"
         width="100px"
         id="back-face"
         alt="like code"
         src="/images/wechatpay.jpg" />
  </div>
  <div class="like-text">“给作者加个鸡腿~”</div>
  <label for="likeCode" class="like-btn">
    <svg viewBox="0 0 1024 1024"
         width="20px"
         style="margin-right: 10px"
         height="20px">
      <path d="M466.88 908.96L113.824 563.296a270.08 270.08 0 0 1 0-387.392c108.8-106.56 284.896-106.56 393.696 0 1.504 1.472 2.976 2.944 4.448 4.48 1.472-1.536 2.944-3.008 4.448-4.48 108.8-106.56 284.896-106.56 393.696 0a269.952 269.952 0 0 1 34.016 347.072l-387.392 385.6a64 64 0 0 1-89.92 0.384z" p-id="13650" fill="#ee4242" />
    </svg>
    喜欢作者
  </label>
</div>

    
    <div class="post-nav">
  
    <div class="post-nav-item-left"></div>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2024/09/23/%E8%87%AA%E5%8A%A8%E4%BA%A4%E6%98%93%20%20ccxt%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596" />
        </svg>
      </div>
      自动交易 | ccxt库的使用
    </a>
  
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              <div class="matts">海</div><div class="matts">内</div><div class="matts">存</div><div class="matts">知</div><div class="matts">己</div>
            </div>
          
            <div class="foot-line">
              <div class="matts">天</div><div class="matts">涯</div><div class="matts">若</div><div class="matts">比</div><div class="matts">邻</div>
            </div>
          
        </div>
        <div class="foot__body">
          
            <div class="foot-item">
              <div class="foot-item__head">朋友</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/icon/icon-link.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://narnona.github.io">kaka</a>
                  </div>
                
                <div class="text">
                  <img alt="link" height="20px" width="20px" src="/images/icon/icon-link+.svg" />
                  <a class="foot-link"
                     href="mailto:?subject=%E7%94%B3%E8%AF%B7%20Hozen.site%20%E7%9A%84%E5%8F%8B%E9%93%BE%E4%BD%8D%E7%BD%AE">
                  申请友链</a>
                </div>
              </div>
            </div>
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/narnona">GitHub</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/x.jfif" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://x.com/yojil341699">Twitter</a>
                  </div>
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/telegram.svg" />
                    <a class="foot-link" target="_blank" rel="noopener" href="https://t.me/tupongren">Telegram</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/icon-email.svg" />
                <a class="foot-link" href="mailto:"></a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="http://example.com">卡  卡</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z" />
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z" />
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z" />
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
        </div>
      </div>
    </div>
    
      <script src="https://unpkg.com/js-polyfills@0.1.43/es6.js"></script>
      <script id="MathJax-script"
              async
              src="https://www.unpkg.com/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
    
    
      <script src="/js/search.js"></script>
      <script>searchInitialize("/search.json")</script>
    
    
  

  </body>
</html>
